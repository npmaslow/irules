create ltm policy /Common/Drafts/httppolicy controls add { asm } requires add { http } rules add { disableWAF { actions add { 0 { asm disable } } ordinal 1 } app1enableWAF { actions add { 0 { asm enable policy /Common/child_policy } } conditions add { 0 { http-header all name Host contains values  { app1 } } } } app2enableWAF { actions add { 0 { asm enable policy /Common/child_policy } } conditions add { 0 { http-header all name Host contains values  { app2 } } } } } strategy first-match
publish ltm policy /Common/Drafts/httppolicy
modify ltm policy httppolicy create-draft
modify ltm policy /Common/Drafts/httppolicy rules add { app3enableWAF { actions add { 0 { asm enable policy /Common/child_policy } } conditions add { 0 { http-header all name Host contains values  { app3 } } } } }
publish ltm policy /Common/Drafts/httppolicy


create ltm policy /Common/Drafts/httpspolicy controls add { asm } requires add { http } rules add { disableWAF { actions add { 0 { asm disable } } ordinal 1 } app1enableWAF { actions add { 0 { asm enable policy /Common/child_policy } } conditions add { 0 { ssl-extension ssl-client-hello server-name values { app1.com } } } } app2enableWAF { actions add { 0 { asm enable policy /Common/child_policy } } conditions add { 0 { ssl-extension ssl-client-hello server-name values  { app2.com } } } } } strategy first-match
publish ltm policy /Common/Drafts/httpspolicy 


create ltm virtual httpgatewayvs { ip-protocol tcp destination 0.0.0.0%1:http mask any policies add { httppolicy } pool tunnel_gateway profiles add { tcp http websecurity } source 0.0.0.0%1/0 source-port preserve-strict translate-address disabled translate-port disabled vlans add { geneve-tunnel } vlans-enabled }

create ltm profile client-ssl appsslclient cert LAB_SELFSIGN key LAB_SELFSIGN ca-file f5-ca-bundle.crt

ltm virtual gateway_vs_https {
    description aws_gateway
    destination /aws_gateway_tenant/0.0.0.0%1:https
    ip-protocol tcp
    last-modified-time 2022-08-15:09:32:25
    mask any
    partition aws_gateway_tenant
    persist {
        /Common/cookie {
            default yes
        }
    }
    policies {
        awsgatewaywafhttpsPolicy { }
    }
    pool tunnel_gateway
    profiles {
        /Common/http { }
        /Common/serverssl {
            context serverside
        }
        /Common/tcp { }
        /Common/websecurity { }
        ASM_wafPolicy { }
        appclientssl {
            context clientside
        }
    }
    serverssl-use-sni disabled
    source 0.0.0.0%1/0
    source-port preserve-strict
    translate-address disabled
    translate-port disabled
    vlans {
        /Common/geneve-tunnel
    }
    vlans-enabled
    vs-index 21
}
